---
import Layout from '../layouts/Layout.astro';
import QueueManager from '../components/QueueManager.astro';
import QueueViewer from '../components/QueueViewer.astro';
---

<Layout title="kickern.in">
  <div class="container mx-auto px-4 py-6 max-w-4xl">

    <div id="viewerWrap">
      <QueueViewer standort="" tisch="" />
    </div>
    
    <div id="managerWrap" class="hidden">
      <QueueManager standort="" tisch="" />
    </div>
  </div>

  <script>
    const formatDisplay = (value: string): string => {
      if (!value) return '';
      return value.replace(/-/g, ' ').replace(/\b\w/g, (ch: string) => ch.toUpperCase());
    };

    const segments = window.location.pathname.replace(/^\/+|\/+$/g, '').split('/');
    const standort = decodeURIComponent(segments[0] || '');
    const tisch = decodeURIComponent(segments[1] || '');
    // Robuste Manager-Modus Erkennung
    const urlParams = new URLSearchParams(window.location.search);
    const isManageMode = urlParams.has('manage') || urlParams.get('manage') === 'true';

    // Wenn Route ung√ºltig ist, zur Startseite
    if (!standort || !tisch) {
      window.location.replace('/');
    } else {
      const viewerWrap = document.getElementById('viewerWrap');
      const managerWrap = document.getElementById('managerWrap');

      if (isManageMode) {
        viewerWrap?.classList.add('hidden');
        managerWrap?.classList.remove('hidden');
      } else {
        viewerWrap?.classList.remove('hidden');
        managerWrap?.classList.add('hidden');
      }
    }
  </script>
</Layout>